<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Or√°culo C√≥smico IA</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script>
    tailwind.config = {
      darkMode: 'class'
    };
  </script>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white">

  <!-- Bot√≥n modo oscuro -->
  <button id="toggleDark"
    class="fixed top-4 right-4 bg-gray-200 dark:bg-gray-700 p-3 rounded-full shadow-lg hover:scale-105 transition ring-2 ring-transparent dark:ring-purple-500 z-50"
    title="Modo oscuro">
    <i data-lucide="moon" class="w-5 h-5 text-gray-800 dark:text-white"></i>
  </button>

  <main class="p-4 pt-20 pb-24 max-w-xl mx-auto">
    <h1 class="text-2xl font-bold mb-6 text-center">üí´ Or√°culo C√≥smico IA</h1>

    <!-- Contenedor IA -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6">
      <h3 class="text-xl font-bold text-center mb-4">üåå Pregunta a la Sabidur√≠a C√≥smica</h3>

      <div class="mb-4">
        <input id="message" type="text" placeholder="Escribe tu pregunta aqu√≠..."
          class="w-full p-3 rounded-full shadow-md border dark:border-gray-700 dark:bg-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-violet-500">
      </div>

      <div class="text-center mb-4">
        <button id="send"
          class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-2 rounded-full font-semibold hover:shadow-lg transition">
          Preguntar a la IA
        </button>
      </div>

      <div id="chat"
        class="mt-4 space-y-2 max-h-64 overflow-y-auto bg-gray-50 dark:bg-gray-900 text-sm p-4 rounded-lg border dark:border-gray-700 text-gray-800 dark:text-gray-200">
        <p class="italic text-gray-500 dark:text-gray-400">Aqu√≠ aparecer√°n las respuestas c√≥smicas ‚ú®</p>
      </div>
    </div>
  </main>

  <!-- Barra de navegaci√≥n inferior -->
  <nav
    class="fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-900 shadow-lg border-t border-gray-200 dark:border-gray-700 z-40">
    <div class="flex justify-around items-center h-16">
      <button onclick="location.href='index.html'"
        class="flex flex-col items-center text-gray-600 dark:text-gray-300 hover:text-purple-500 transition">
        <i data-lucide="home" class="w-6 h-6"></i>
        <span class="text-xs">Inicio</span>
      </button>
      <button onclick="location.href='fuego.html'"
        class="flex flex-col items-center text-gray-600 dark:text-gray-300 hover:text-red-500 transition">
        <i data-lucide="flame" class="w-6 h-6"></i>
        <span class="text-xs">Energ√≠a</span>
      </button>
      <button onclick="location.href='agregar.html'"
        class="bg-purple-600 p-4 rounded-full text-white shadow-md -mt-10 hover:bg-purple-700 transition">
        <i data-lucide="plus" class="w-6 h-6"></i>
      </button>
      <button onclick="location.href='mensaje.html'"
        class="flex flex-col items-center text-blue-500 dark:text-blue-400 font-bold">
        <i data-lucide="message-circle" class="w-6 h-6"></i>
        <span class="text-xs">Mensaje</span>
      </button>
      <button onclick="location.href='ajustes.html'"
        class="flex flex-col items-center text-gray-600 dark:text-gray-300 hover:text-green-500 transition">
        <i data-lucide="settings" class="w-6 h-6"></i>
        <span class="text-xs">Ajustes</span>
      </button>
    </div>
  </nav>

  <!-- Scripts -->
  <script>
    lucide.createIcons();

    // Modo oscuro toggle
    const toggle = document.getElementById('toggleDark');
    toggle.addEventListener('click', () => {
      const isDark = document.documentElement.classList.toggle('dark');
      localStorage.setItem('modoOscuro', isDark);
      toggle.classList.toggle('ring-purple-500');
      toggle.classList.toggle('scale-110');
      lucide.createIcons();
    });

    // Aplicar modo oscuro si est√° activado
    if (localStorage.getItem('modoOscuro') === 'true') {
      document.documentElement.classList.add('dark');
      toggle.classList.add('ring-purple-500', 'scale-110');
    }
  </script>

  <script>
    const apiKey = "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";
    const chat = document.getElementById("chat");
    const input = document.getElementById("message");
    const sendBtn = document.getElementById("send");

    // Cargar historial guardado
    window.addEventListener("DOMContentLoaded", () => {
      const guardados = JSON.parse(localStorage.getItem("chatCosmico")) || [];
      guardados.forEach(m => addMessage(m.sender, m.text));
    });

    sendBtn.addEventListener("click", async () => {
      const message = input.value.trim();
      if (!message) return;

      addMessage("T√∫", message);
      saveMessage("T√∫", message);
      input.value = "";

      showTyping();

      try {
        const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${apiKey}`,
            "Content-Type": "application/json",
            "HTTP-Referer": "http://localhost",
            "X-Title": "RuletaCosmica"
          },
          body: JSON.stringify({
            model: "mistralai/mistral-7b-instruct",
            messages: [
              {
                role: "system",
                content: "Eres una IA que da consejos de abundancia, finanzas y h√°bitos de vida para mejorar al usuario. Te llamas Cosmic. Tu deber es ayudar, dar frases c√≥smicas l√≥gicas, y acoplarte al estado de √°nimo del usuario. Si no est√° triste, responde en menos de 9 palabras. Siempre pregunta en qu√© puedes ayudar y da un consejo sabio pero l√≥gico."
              },
              {
                role: "user",
                content: message
              }
            ]
          })
        });

        const data = await response.json();
        removeTyping();

        const reply = data.choices?.[0]?.message?.content || "Ups, no recib√≠ respuesta del universo. üåå";
        addMessage("üå† Sabidur√≠a C√≥smica", reply);
        saveMessage("üå† Sabidur√≠a C√≥smica", reply);

      } catch (error) {
        console.error("Error:", error);
        removeTyping();
        const errMsg = "El canal c√≥smico est√° bloqueado. Intenta m√°s tarde. ü™ê";
        addMessage("üå† Sabidur√≠a C√≥smica", errMsg);
        saveMessage("üå† Sabidur√≠a C√≥smica", errMsg);
      }
    });

    function addMessage(sender, text) {
      const msg = document.createElement("div");
      msg.className = "p-3 rounded-lg bg-gray-100 dark:bg-gray-800 shadow mb-2";
      msg.innerHTML = `<strong>${sender}:</strong><br>${text}`;
      chat.appendChild(msg);
      chat.scrollTop = chat.scrollHeight;
    }

    function showTyping() {
      const typing = document.createElement("div");
      typing.id = "typing";
      typing.className = "p-3 italic text-gray-500 dark:text-gray-400";
      typing.innerHTML = `<strong>üå† Sabidur√≠a C√≥smica:</strong> escribiendo... ‚úçÔ∏è`;
      chat.appendChild(typing);
      chat.scrollTop = chat.scrollHeight;
    }

    function removeTyping() {
      const typing = document.getElementById("typing");
      if (typing) typing.remove();
    }

    function saveMessage(sender, text) {
      const mensajes = JSON.parse(localStorage.getItem("chatCosmico")) || [];
      mensajes.push({ sender, text });
      localStorage.setItem("chatCosmico", JSON.stringify(mensajes));
    }
  </script>
</body>
</html>
